# JSON 解析器项目代码审查指南

本指南为 JSON 解析器项目代码审查提供基本标准和流程，旨在确保代码质量、可维护性和安全性。

## 代码审查目标

1. 确保代码符合项目规范和最佳实践
2. 提高代码质量和可维护性
3. 发现并解决潜在的问题和漏洞
4. 知识共享和团队能力提升
5. 确保性能和安全性满足要求

## 代码审查清单

### 1. 功能性

- [ ] 代码实现是否完全满足功能需求？
- [ ] 是否处理了所有边界条件和特殊情况？
- [ ] 单元测试是否覆盖了主要功能路径和边界条件？
- [ ] 对于 JSON 格式解析，是否符合 RFC 8259 规范？
- [ ] 输入验证是否完整？是否能够正确处理格式错误的输入？

### 2. 代码结构与设计

- [ ] 代码结构是否清晰，职责划分是否合理？
- [ ] 是否遵循单一职责原则？每个函数和模块是否只做一件事？
- [ ] 数据结构选择是否合适？是否能高效处理预期的数据量？
- [ ] 是否有不必要的复杂性？是否可以简化？
- [ ] API 设计是否直观、一致，易于使用？
- [ ] 是否考虑了扩展性？未来添加新特性是否容易？

### 3. 代码风格与可读性

- [ ] 代码是否遵循项目的代码风格指南？
- [ ] 命名是否清晰、一致且有意义？
- [ ] 注释是否充分且有用？是否解释了"为什么"而不仅仅是"做了什么"？
- [ ] 代码是否易于理解？另一个开发者是否能够轻松理解它？
- [ ] 函数和方法长度是否合理？是否需要拆分？
- [ ] 缩进、空格和括号使用是否一致？

### 4. 性能考量

- [ ] 代码是否高效？有没有明显的性能瓶颈？
- [ ] 内存使用是否合理？是否存在内存泄漏？
- [ ] 对于大型 JSON 文件，解析性能是否可接受？
- [ ] 是否有不必要的计算或重复工作？
- [ ] 对于高频操作路径，是否进行了优化？

### 5. 错误处理

- [ ] 是否妥善处理了所有可能的错误情况？
- [ ] 错误消息是否清晰、有用且包含足够的上下文？
- [ ] 是否正确使用了错误处理机制？
- [ ] 是否有合适的异常/错误传播策略？
- [ ] 对于关键操作失败，是否有合适的恢复机制？

### 6. 安全性

- [ ] 代码是否存在安全漏洞？（如缓冲区溢出、整数溢出等）
- [ ] 是否可能受到拒绝服务攻击？（如深度嵌套的 JSON 结构）
- [ ] 是否安全地处理了用户输入数据？
- [ ] 是否防范了 JSON 注入攻击？
- [ ] 是否限制了资源使用（内存、CPU等）？

### 7. 可测试性

- [ ] 代码是否易于测试？
- [ ] 是否有足够的单元测试覆盖率？
- [ ] 测试是否检验了各种情况，包括正常路径和错误路径？
- [ ] 是否测试了边界条件和极端情况？
- [ ] 是否包含性能测试？

## 代码审查流程

### 提交前准备

1. **自我审查**：提交者应先自行检查代码，确保它满足上述标准
2. **运行所有测试**：确保所有测试通过
3. **格式化代码**：使用项目指定的格式化工具格式化代码
4. **撰写清晰的提交信息**：简要描述变更内容和原因

### 审查流程

1. **初步评估**：审查者快速浏览代码，了解整体变更
2. **详细审查**：按照审查清单逐项检查
3. **运行代码**：在本地拉取代码，运行测试，验证功能
4. **记录发现的问题**：使用评论明确指出问题并提出建议
5. **跟进解决方案**：与提交者讨论问题和解决方案

### 审查反馈

提供反馈时，请遵循以下原则：

- **具体而不是笼统**：指出具体的代码行和具体问题
- **解释为什么**：解释为什么这是一个问题，以及可能的影响
- **提供建议**：尽可能提供改进建议或替代方案
- **使用提问而非命令**：例如"我们是否可以...？"而不是"你应该..."
- **关注代码而非开发者**：评论应该针对代码，而不是针对开发者个人
- **肯定积极的部分**：也要指出做得好的地方，不只关注问题

## JSON 解析器特定审查重点

### 解析器核心

- [ ] 递归下降解析器设计是否正确？
- [ ] 是否正确处理了 JSON 的所有数据类型？
- [ ] 是否正确处理了 Unicode 字符和转义序列？
- [ ] 解析过程中是否有足够的错误处理和恢复机制？
- [ ] 解析器是否能够处理嵌套的复杂结构？

### 内存管理

- [ ] 字符串、数组和对象的内存分配策略是否高效？
- [ ] 是否存在内存泄漏的可能性？
- [ ] 是否有适当的资源释放机制？
- [ ] 对于大型 JSON 文档，内存使用是否可接受？

### 特殊特性处理

- [ ] JSON Schema 验证是否正确实现？
- [ ] JSON Pointer 功能是否符合规范？
- [ ] 循环引用检测是否有效？
- [ ] 对于非标准 JSON 扩展（如注释、尾随逗号等），处理是否符合预期？

## 常见问题及解决方案

### 1. 内存管理问题

**问题**：内存泄漏或使用已释放的内存
**解决方案**：实施一致的内存所有权模型，确保每个内存块都有明确的释放责任

### 2. 递归深度限制

**问题**：对于深度嵌套的 JSON 结构可能导致栈溢出
**解决方案**：实现深度限制，或使用非递归的解析方法

### 3. Unicode 处理

**问题**：不正确处理 Unicode 字符和代理对
**解决方案**：正确实现 UTF-8/UTF-16 编码和解码，特别注意代理对的处理

### 4. 数值精度

**问题**：浮点数精度损失或溢出
**解决方案**：特别注意极大或极小值的处理，考虑使用适当的数值表示方法

### 5. 错误报告不清晰

**问题**：错误消息不足以定位问题
**解决方案**：提供详细的错误信息，包括错误位置、类型和上下文

## 总结

代码审查是保证代码质量的重要环节。通过遵循本指南，我们可以确保 JSON 解析器项目的代码质量、可维护性和安全性。请记住，代码审查的目标不仅是找出问题，也是共享知识和相互学习的过程。 